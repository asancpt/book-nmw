






![Cover](cover.jpg)

# NONMEM workshop 2017

- author: Sungpil Han, Kyun-Seop Bae
- date: 2017-02-22
- <https://github.com/asancpt/nmw2017edison>
- license: GPL-3

## Introduction

NONMEM Workshop 2017에서 사용된 nmw 패키지를 사용한 Edison 사이언스 앱입니다. [@Kim_2015;@Bae_2016;@Bae_2017]

## Result

A table (head) and a figure of input dataset is shown below.

### Initial values


```r
kable(inputFirst, format = "markdown")
```



|          |V2                                          |
|:---------|:-------------------------------------------|
|Dataset   |Theoph                                      |
|Method    |ZERO                                        |
|nTheta    |3                                           |
|nEta      |3                                           |
|nEps      |2                                           |
|THETAinit |2, 50, 0.1                                  |
|OMinit    |0.2, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, 0.2 |
|SGinit    |0.1, 0, 0, 0.1                              |

### Input Table




```r
kable(head(DataAll, n = 20), caption = "input data")
```



Table: input data

ID     TIME      DV
---  ------  ------
1      0.00    0.74
1      0.25    2.84
1      0.57    6.57
1      1.12   10.50
1      2.02    9.66
1      3.82    8.58
1      5.10    8.36
1      7.03    7.47
1      9.05    6.89
1     12.12    5.94
1     24.37    3.28
2      0.00    0.00
2      0.27    1.72
2      0.52    7.91
2      1.00    8.31
2      1.92    8.33
2      3.50    6.85
2      5.02    6.08
2      7.03    5.40
2      9.00    4.55

### Figure



![Concentration-time curve of Theoph](xyplot.jpg)

### Method Calculation

- Dataset: Theoph
- Method: ZERO


```r
########
PREDFILE <- ifelse(NMDataset == "Emax", "03-Emax/PRED.R", "04-THEO/PRED.R")

InitPara = InitStep(DataAll, THETAinit=THETAinit, OMinit=OMinit, SGinit=SGinit, 
                    nTheta=nTheta, LB=LB, UB=UB, METHOD=METHOD, PredFile=PREDFILE)

(EstRes = EstStep())           # 0.6200359 secs, 0.4930282 secs
```

```
## $`Initial OFV`
## [1] 141.3076
## 
## $Time
## Time difference of 8.754787 secs
## 
## $Optim
## $Optim$par
##  [1]  0.560417594 -0.167835388  0.148962362  0.995143049  0.056166719
##  [6]  0.151227211 -1.032468525  0.005776729  0.110936465 -0.956899772
## [11] -0.205559310
## 
## $Optim$value
## [1] 57.32106
## 
## $Optim$counts
## function gradient 
##       74       74 
## 
## $Optim$convergence
## [1] 0
## 
## $Optim$message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"
## 
## $Optim$hessian
##              [,1]        [,2]         [,3]         [,4]         [,5]
##  [1,]  360.125169  -323.53038 -108.3543319  -69.8402105   621.409519
##  [2,] -323.530378  1611.58184  -61.6390850   89.6421246 -2039.216000
##  [3,] -108.354332   -61.63909  757.3212792   48.7772123   376.582277
##  [4,]  -69.840211    89.64212   48.7772123   81.6923601  -392.973678
##  [5,]  621.409519 -2039.21600  376.5822773 -392.9736781  6114.008561
##  [6,]  -10.380642   -91.50768 -419.3326175 -107.0493598   202.946777
##  [7,]    2.327798   -40.67121    0.2745091    0.9316284   -17.212220
##  [8,]   54.279079  -228.18386   26.9047888   -2.5504603    65.327637
##  [9,]   12.171816   -46.58010  -77.3391041   -1.8199367     1.253022
## [10,]   38.043777  -223.22951  -35.6835104    0.8033799   -13.183290
## [11,]   -1.205588   -43.22499  -45.4265500    1.7833191    27.462355
##               [,6]        [,7]        [,8]        [,9]        [,10]
##  [1,]  -10.3806417   2.3277984   54.279079  12.1718155   38.0437774
##  [2,]  -91.5076838 -40.6712112 -228.183858 -46.5800989 -223.2295107
##  [3,] -419.3326175   0.2745091   26.904789 -77.3391041  -35.6835104
##  [4,] -107.0493598   0.9316284   -2.550460  -1.8199367    0.8033799
##  [5,]  202.9467775 -17.2122196   65.327637   1.2530218  -13.1832896
##  [6,]  732.7780263  -0.1239813   -7.907873  13.7096922    2.3498271
##  [7,]   -0.1239813  32.3757616   12.418354   0.3843555    7.0190576
##  [8,]   -7.9078730  12.4183538  211.753889  13.9743552   -4.3449898
##  [9,]   13.7096922   0.3843555   13.974355  35.1993929   -0.2689585
## [10,]    2.3498271   7.0190576   -4.344990  -0.2689585  225.0618099
## [11,]  -15.2968152  -0.3519534   -6.652685   5.4827782   34.4482720
##             [,11]
##  [1,]  -1.2055875
##  [2,] -43.2249906
##  [3,] -45.4265500
##  [4,]   1.7833191
##  [5,]  27.4623553
##  [6,] -15.2968152
##  [7,]  -0.3519534
##  [8,]  -6.6526851
##  [9,]   5.4827782
## [10,]  34.4482720
## [11,]  93.6733297
## 
## 
## $`Final Estimates`
##  [1]  3.16946754 38.25213461  0.10501808  1.19823326  0.13747849
##  [6]  0.03134899  0.37015671  0.04340042  0.25068582  0.01207782
## [11]  0.05427434
```

```r
(CovRes = CovStep())
```

```
## $Time
## Time difference of 2.438244 secs
## 
## $`Standard Error`
##  [1] 0.641082199 1.685216557 0.023072282 0.420631738 0.082198220
##  [6] 0.019813069 0.340281010 0.023052024 0.289529829 0.003576926
## [11] 0.032078220
## 
## $`Covariance Matrix of Estimates`
##                [,1]         [,2]          [,3]          [,4]          [,5]
##  [1,]  0.4109863857  0.339172590  5.746941e-03  0.2058205735  2.004225e-03
##  [2,]  0.3391725901  2.839954846  5.032973e-03  0.3376156674  3.490413e-02
##  [3,]  0.0057469407  0.005032973  5.323302e-04  0.0016296312 -1.042015e-03
##  [4,]  0.2058205735  0.337615667  1.629631e-03  0.1769310592  1.951556e-02
##  [5,]  0.0020042251  0.034904130 -1.042015e-03  0.0195155623  6.756547e-03
##  [6,] -0.0021925721  0.012804455 -2.504044e-04  0.0032072276  1.504708e-03
##  [7,]  0.1215964609  0.149097976  7.112151e-03  0.0575786301 -1.010228e-02
##  [8,]  0.0009975339  0.023865652  6.272044e-05  0.0042160662  8.584546e-04
##  [9,]  0.0669968434  0.057331163  6.226299e-03  0.0179887087 -1.309284e-02
## [10,]  0.0010500362  0.001807768  5.805567e-05  0.0005143821 -7.516926e-05
## [11,] -0.0049729750 -0.009950687 -4.790623e-04 -0.0010146695  9.532828e-04
##                [,6]          [,7]         [,8]          [,9]         [,10]
##  [1,] -2.192572e-03  0.1215964609 9.975339e-04  0.0669968434  1.050036e-03
##  [2,]  1.280446e-02  0.1490979757 2.386565e-02  0.0573311627  1.807768e-03
##  [3,] -2.504044e-04  0.0071121506 6.272044e-05  0.0062262995  5.805567e-05
##  [4,]  3.207228e-03  0.0575786301 4.216066e-03  0.0179887087  5.143821e-04
##  [5,]  1.504708e-03 -0.0101022789 8.584546e-04 -0.0130928433 -7.516926e-05
##  [6,]  3.925577e-04 -0.0028274168 2.326252e-04 -0.0032699346 -2.051402e-05
##  [7,] -2.827417e-03  0.1157911655 3.116405e-03  0.0940141158  9.767423e-04
##  [8,]  2.326252e-04  0.0031164054 5.313958e-04  0.0018657633  2.786133e-05
##  [9,] -3.269935e-03  0.0940141158 1.865763e-03  0.0838275220  8.055551e-04
## [10,] -2.051402e-05  0.0009767423 2.786133e-05  0.0008055551  1.279440e-05
## [11,]  1.806777e-04 -0.0038609230 2.199510e-04 -0.0033970761 -2.824836e-05
##               [,11]
##  [1,] -4.972975e-03
##  [2,] -9.950687e-03
##  [3,] -4.790623e-04
##  [4,] -1.014670e-03
##  [5,]  9.532828e-04
##  [6,]  1.806777e-04
##  [7,] -3.860923e-03
##  [8,]  2.199510e-04
##  [9,] -3.397076e-03
## [10,] -2.824836e-05
## [11,]  1.029012e-03
## 
## $`Correlation Matrix of Estimates`
##              [,1]       [,2]       [,3]        [,4]        [,5]       [,6]
##  [1,]  1.00000000  0.3139434  0.3885371  0.76326092  0.03803386 -0.1726189
##  [2,]  0.31394337  1.0000000  0.1294429  0.47628273  0.25197571  0.3834896
##  [3,]  0.38853706  0.1294429  1.0000000  0.16791780 -0.54944069 -0.5477718
##  [4,]  0.76326092  0.4762827  0.1679178  1.00000000  0.56443848  0.3848363
##  [5,]  0.03803386  0.2519757 -0.5494407  0.56443848  1.00000000  0.9239281
##  [6,] -0.17261892  0.3834896 -0.5477718  0.38483626  0.92392809  1.0000000
##  [7,]  0.55740326  0.2600030  0.9058842  0.40227364 -0.36117629 -0.4193729
##  [8,]  0.06750017  0.6143396  0.1179260  0.43480679  0.45304973  0.5093260
##  [9,]  0.36095022  0.1175010  0.9320649  0.14770821 -0.55014636 -0.5700251
## [10,]  0.45791048  0.2999005  0.7034676  0.34188013 -0.25566300 -0.2894603
## [11,] -0.24182005 -0.1840717 -0.6472785 -0.07519905  0.36153395  0.2842775
##             [,7]       [,8]       [,9]      [,10]       [,11]
##  [1,]  0.5574033 0.06750017  0.3609502  0.4579105 -0.24182005
##  [2,]  0.2600030 0.61433960  0.1175010  0.2999005 -0.18407173
##  [3,]  0.9058842 0.11792597  0.9320649  0.7034676 -0.64727852
##  [4,]  0.4022736 0.43480679  0.1477082  0.3418801 -0.07519905
##  [5,] -0.3611763 0.45304973 -0.5501464 -0.2556630  0.36153395
##  [6,] -0.4193729 0.50932602 -0.5700251 -0.2894603  0.28427747
##  [7,]  1.0000000 0.39728957  0.9542497  0.8024765 -0.35370660
##  [8,]  0.3972896 1.00000000  0.2795466  0.3378959  0.29744497
##  [9,]  0.9542497 0.27954657  1.0000000  0.7778430 -0.36576462
## [10,]  0.8024765 0.33789587  0.7778430  1.0000000 -0.24619145
## [11,] -0.3537066 0.29744497 -0.3657646 -0.2461915  1.00000000
## 
## $`Inverse Covariance Matrix of Estimates`
##              [,1]         [,2]        [,3]        [,4]        [,5]
##  [1,]   106.16065    -68.57382    6448.999    335.8684   -2554.404
##  [2,]   -68.57382     58.03941   -4878.748   -302.1408    2175.297
##  [3,]  6448.99852  -4878.74849  589180.992  26966.5581 -188642.120
##  [4,]   335.86844   -302.14081   26966.558   1681.5428  -11681.295
##  [5,] -2554.40394   2175.29734 -188642.120 -11681.2952   84767.258
##  [6,]  -386.86931    570.21645  -66146.856  -3404.8197   13635.268
##  [7,] -1202.16141    939.99770  -90186.515  -5086.8799   35747.155
##  [8,] 10794.55146  -8973.05055  795473.729  47387.0493 -336778.044
##  [9,]   -49.37881     87.67863  -10522.034   -442.5923    3308.341
## [10,] 11656.74771 -10122.84996  899033.473  53311.4447 -378718.176
## [11,] -1043.10865   1001.74425  -47225.353  -4879.4941   35062.926
##               [,6]         [,7]        [,8]         [,9]      [,10]
##  [1,]    -386.8693   -1202.1614   10794.551    -49.37881   11656.75
##  [2,]     570.2165     939.9977   -8973.051     87.67863  -10122.85
##  [3,]  -66146.8560  -90186.5151  795473.729 -10522.03399  899033.47
##  [4,]   -3404.8197   -5086.8799   47387.049   -442.59232   53311.44
##  [5,]   13635.2681   35747.1551 -336778.044   3308.34086 -378718.18
##  [6,]   72185.7024   10923.6924 -116901.740   2827.83390 -138706.47
##  [7,]   10923.6924   16640.0822 -149635.979    965.67561 -166637.22
##  [8,] -116901.7395 -149635.9793 1416416.592 -14025.21771 1587796.81
##  [9,]    2827.8339     965.6756  -14025.218    954.64170  -20046.64
## [10,] -138706.4681 -166637.2194 1587796.806 -20046.64476 2031530.59
## [11,]   15687.5103   14275.7624 -151936.386    935.22997 -170270.99
##             [,11]
##  [1,]   -1043.109
##  [2,]    1001.744
##  [3,]  -47225.353
##  [4,]   -4879.494
##  [5,]   35062.926
##  [6,]   15687.510
##  [7,]   14275.762
##  [8,] -151936.386
##  [9,]     935.230
## [10,] -170270.992
## [11,]   28036.417
## 
## $`Eigen Values`
##  [1] 0.0002519231 0.0096726361 0.0108356932 0.0233182487 0.0520713921
##  [6] 0.2982385816 0.5047727356 0.9114673181 1.2087849223 3.2082293108
## [11] 4.7723572385
## 
## $`R Matrix`
##              [,1]         [,2]         [,3]         [,4]         [,5]
##  [1,]   17.924809   -1.3343244  -162.767616   -4.1309688    21.546428
##  [2,]   -1.334324    0.5507361    -7.672317    0.1118331    -1.462877
##  [3,] -162.767616   -7.6723175 34333.362989   86.0270258   433.962804
##  [4,]   -4.130969    0.1118331    86.027026   28.6262216  -177.270074
##  [5,]   21.546428   -1.4628773   433.962804 -177.2700737  1930.445640
##  [6,]   10.225997  -16.5210370    13.387980  272.9374910 -4270.878519
##  [7,]  -11.022744    2.9849020   -90.741381  -52.9263583   210.709459
##  [8,]   52.304359  -18.2457174   956.482180  164.3159947 -1421.957489
##  [9,]    7.044880   -2.2338971 -1350.939506   24.4538449   -43.763337
## [10,]  248.456496 -120.7991142 -7033.212114   50.2330066 -1013.856454
## [11,]   -1.752153   -5.2052312 -1992.414014    6.0122012   124.417592
##              [,6]        [,7]        [,8]         [,9]        [,10]
##  [1,]    10.22600  -11.022744    52.30436     7.044880    248.45650
##  [2,]   -16.52104    2.984902   -18.24572    -2.233897   -120.79911
##  [3,]    13.38798  -90.741381   956.48218 -1350.939506  -7033.21211
##  [4,]   272.93749  -52.926358   164.31599    24.453845     50.23301
##  [5,] -4270.87852  210.709459 -1421.95749   -43.763337  -1013.85645
##  [6,] 16610.43881 -139.814071  1113.59933    18.726369   4680.60017
##  [7,]  -139.81407  213.229103  -555.99366  -151.083356     96.25921
##  [8,]  1113.59933 -555.993657  4043.51420   130.795153   -555.76880
##  [9,]    18.72637 -151.083356   130.79515   236.875498    -20.42575
## [10,]  4680.60017   96.259209  -555.76880   -20.425755 192857.05218
## [11,]   -46.02939  -62.941078  -201.26736    92.657112   6568.90949
##              [,11]
##  [1,]    -1.752153
##  [2,]    -5.205231
##  [3,] -1992.414014
##  [4,]     6.012201
##  [5,]   124.417592
##  [6,]   -46.029388
##  [7,]   -62.941078
##  [8,]  -201.267356
##  [9,]    92.657112
## [10,]  6568.909490
## [11,]  3974.804240
## 
## $`S Matrix`
##               [,1]         [,2]         [,3]         [,4]        [,5]
##  [1,]    78.316509   -4.6468525  -1295.13192   -11.873085   142.72165
##  [2,]    -4.646852    0.7648878     64.36589     2.623533   -28.61925
##  [3,] -1295.131916   64.3658920 183632.39794  -230.636176   840.38213
##  [4,]   -11.873085    2.6235332   -230.63618    18.368716  -171.71679
##  [5,]   142.721652  -28.6192544    840.38213  -171.716793  2005.81551
##  [6,]  -145.835175   29.4905945   9000.10284   291.779613 -3809.95406
##  [7,]   -26.707401    0.2387057   3794.27704   -19.686952    51.76139
##  [8,]    44.375129   10.7614123 -10813.66437    84.841787  -765.19107
##  [9,]    13.946014   -4.4042212  -6396.75146     3.480210    87.90129
## [10,]  2039.647983 -397.4745826  -4148.02651 -1170.279731  8916.77583
## [11,]   279.500822  -47.3111189 -60483.51062   -22.729229   670.78874
##              [,6]          [,7]         [,8]         [,9]       [,10]
##  [1,]  -145.83517   -26.7074009     44.37513    13.946014   2039.6480
##  [2,]    29.49059     0.2387057     10.76141    -4.404221   -397.4746
##  [3,]  9000.10284  3794.2770421 -10813.66437 -6396.751456  -4148.0265
##  [4,]   291.77961   -19.6869517     84.84179     3.480210  -1170.2797
##  [5,] -3809.95406    51.7613890   -765.19107    87.901294   8916.7758
##  [6,] 12023.28649   188.5688350    667.62858  -711.894527  -3829.1366
##  [7,]   188.56884   129.3349740   -292.66398  -155.764410   1796.9713
##  [8,]   667.62858  -292.6639805   1121.03185   294.247259 -10631.8774
##  [9,]  -711.89453  -155.7644101    294.24726   327.282119   1812.2113
## [10,] -3829.13664  1796.9713154 -10631.87739  1812.211283 419517.6542
## [11,] -3489.01510 -1105.9231044   2773.71161  2358.454994  18067.4267
##              [,11]
##  [1,]    279.50082
##  [2,]    -47.31112
##  [3,] -60483.51062
##  [4,]    -22.72923
##  [5,]    670.78874
##  [6,]  -3489.01510
##  [7,]  -1105.92310
##  [8,]   2773.71161
##  [9,]   2358.45499
## [10,]  18067.42672
## [11,]  24042.66051
```

```r
PostHocEta() # FinalPara from EstStep()
```

```
##       ID       ETA1         ETA2        ETA3
##  [1,] 11 -0.6974335 -0.243282942 -0.69037780
##  [2,]  6 -0.4541861 -0.147886222 -0.06687408
##  [3,]  5 -0.3057577 -0.113561181 -0.20461680
##  [4,]  7 -1.0816386 -0.197886604 -0.18247171
##  [5,] 12 -0.8125117 -0.304776227 -0.23195437
##  [6,]  1 -1.1279804  0.047074816 -0.04894822
##  [7,]  2 -1.5534136 -0.110439191 -0.11125626
##  [8,]  3 -0.7317621 -0.034820924 -0.19527878
##  [9,]  8  0.7432273  0.020074101 -0.19511858
## [10,] 10 -1.3896142 -0.322504556 -0.44454017
## [11,]  4  0.1547899  0.003895175 -0.07657178
## [12,]  9 -1.3356243 -0.369231406 -0.10314531
```

```r
get("EBE", envir=e)
```

```
##       ID       ETA1         ETA2        ETA3
##  [1,] 11 -0.6974335 -0.243282942 -0.69037780
##  [2,]  6 -0.4541861 -0.147886222 -0.06687408
##  [3,]  5 -0.3057577 -0.113561181 -0.20461680
##  [4,]  7 -1.0816386 -0.197886604 -0.18247171
##  [5,] 12 -0.8125117 -0.304776227 -0.23195437
##  [6,]  1 -1.1279804  0.047074816 -0.04894822
##  [7,]  2 -1.5534136 -0.110439191 -0.11125626
##  [8,]  3 -0.7317621 -0.034820924 -0.19527878
##  [9,]  8  0.7432273  0.020074101 -0.19511858
## [10,] 10 -1.3896142 -0.322504556 -0.44454017
## [11,]  4  0.1547899  0.003895175 -0.07657178
## [12,]  9 -1.3356243 -0.369231406 -0.10314531
```

## Appendix

### Examples for Initial Values

#### Emax
```
nTheta = 2
nEta = 1
nEps = 1

THETAinit = 10, 100
OMinit = 0.2
SGinit = 1
```

#### Theoph (ZERO, CONC)
```
nTheta = 3
nEta = 3
nEps = 2

THETAinit = 2, 50, 0.1
OMinit = 0.2, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, 0.2
SGinit = 0.1, 0, 0, 0.1
```

#### Theoph (LAPL)

```
THETAinit = 4, 50, 0.2
```

The other values are the same with those of `Theoph (ZERO, CONC)`.

## Reference

[1] K. Bae. _nmw: NONMEM Workshop 2017_. R package version 0.1.0. 2017. <URL:
http://optimizer.r-forge.r-project.org/>.

[2] K. Bae and D. Yim. “R-based reproduction of the estimation process hidden behind
NONMEM® Part 2: First-order conditional estimation”. In: _Translational and Clinical
Pharmacology_ 24.4 (2016), p. 161. DOI: 10.12793/tcp.2016.24.4.161. <URL:
https://doi.org/10.12793%2Ftcp.2016.24.4.161}.>

[3] M. Kim, D. Yim and K. Bae. “R-based reproduction of the estimation process hidden
behind NONMEM® Part 1: first-order approximation method”. In: _Translational and Clinical
Pharmacology_ 23.1 (2015), p. 1. DOI: 10.12793/tcp.2015.23.1.1. <URL:
https://doi.org/10.12793%2Ftcp.2015.23.1.1}.>

## Bibliography
