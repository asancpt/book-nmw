<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 이론 및 계산방법 | nmw: R패키지를 통해 이해하는 비선형 혼합효과 모델링</title>
  <meta name="description" content="2 이론 및 계산방법 | nmw: R패키지를 통해 이해하는 비선형 혼합효과 모델링" />
  <meta name="generator" content="bookdown 0.19.1 and GitBook 2.6.7" />

  <meta property="og:title" content="2 이론 및 계산방법 | nmw: R패키지를 통해 이해하는 비선형 혼합효과 모델링" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://book-nmw.netlify.com/" />
  <meta property="og:image" content="https://book-nmw.netlify.com/assets/cover.jpg" />
  
  <meta name="github-repo" content="asancpt/book-nmw" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 이론 및 계산방법 | nmw: R패키지를 통해 이해하는 비선형 혼합효과 모델링" />
  
  
  <meta name="twitter:image" content="https://book-nmw.netlify.com/assets/cover.jpg" />

<meta name="author" content="한성필, 배균섭" />


<meta name="date" content="2020-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="nonmem-document.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">NONMEM estimation using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>책머리에</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> 서론</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>1.1</b> Maximum Likelihood Estimation</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#이론적-배경"><i class="fa fa-check"></i><b>1.2</b> 이론적 배경</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#first-order-conditional-estimation-foce-method"><i class="fa fa-check"></i><b>1.3</b> First-order conditional estimation (FOCE) method</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="method.html"><a href="method.html"><i class="fa fa-check"></i><b>2</b> 이론 및 계산방법</a>
<ul>
<li class="chapter" data-level="2.1" data-path="method.html"><a href="method.html#설치"><i class="fa fa-check"></i><b>2.1</b> 설치</a></li>
<li class="chapter" data-level="2.2" data-path="method.html"><a href="method.html#actual-example"><i class="fa fa-check"></i><b>2.2</b> 실제 사례</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="nonmem-document.html"><a href="nonmem-document.html"><i class="fa fa-check"></i><b>3</b> NONMEM document</a>
<ul>
<li class="chapter" data-level="3.1" data-path="nonmem-document.html"><a href="nonmem-document.html#r에서의-구현"><i class="fa fa-check"></i><b>3.1</b> R에서의 구현</a></li>
<li class="chapter" data-level="3.2" data-path="nonmem-document.html"><a href="nonmem-document.html#Theoph"><i class="fa fa-check"></i><b>3.2</b> Theophylline 예제 데이터셋</a></li>
<li class="chapter" data-level="3.3" data-path="nonmem-document.html"><a href="nonmem-document.html#고유값eigenvalue"><i class="fa fa-check"></i><b>3.3</b> 고유값(Eigenvalue)</a></li>
<li class="chapter" data-level="3.4" data-path="nonmem-document.html"><a href="nonmem-document.html#자료"><i class="fa fa-check"></i><b>3.4</b> 자료</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="result.html"><a href="result.html"><i class="fa fa-check"></i><b>4</b> 결과</a></li>
<li class="chapter" data-level="5" data-path="acknowledgement.html"><a href="acknowledgement.html"><i class="fa fa-check"></i><b>5</b> 감사의 글</a></li>
<li class="appendix"><span><b>별첨</b></span></li>
<li class="chapter" data-level="A" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>A</b> 에디슨 앱</a></li>
<li class="chapter" data-level="B" data-path="세션정보.html"><a href="세션정보.html"><i class="fa fa-check"></i><b>B</b> 세션정보</a></li>
<li class="chapter" data-level="" data-path="참고문헌.html"><a href="참고문헌.html"><i class="fa fa-check"></i>참고문헌</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">nmw: R패키지를 통해 이해하는 비선형 혼합효과 모델링</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="method" class="section level1" number="2">
<h1><span class="header-section-number">2</span> 이론 및 계산방법</h1>
<div id="설치" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> 설치</h2>
<p>먼저 R 패키지의 설치 및 로딩 과정은 다음의 명령어를 R 콘솔에 입력함으로서 가능합니다.
NONMEM Workshop 2017에서 사용된 nmw 패키지입니다. <span class="citation">(Kim, Yim, and Bae <a href="#ref-kim2015r" role="doc-biblioref">2015</a>; Bae and Yim <a href="#ref-bae2016r" role="doc-biblioref">2016</a>; Bae <a href="#ref-R-nmw" role="doc-biblioref">2018</a>)</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="method.html#cb1-1"></a><span class="kw">install.packages</span>(<span class="st">&#39;nmw&#39;</span>)</span>
<span id="cb1-2"><a href="method.html#cb1-2"></a><span class="kw">library</span>(nmw)</span></code></pre></div>
<p>NONMEM을 통해 얻은 <code>THEO-FO.OUT</code>와 비교할 때 값이 같습니다.</p>
<p>Scaling factor는 소스 코드를 보고 알아낸 것입니다.</p>
</div>
<div id="actual-example" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> 실제 사례</h2>
<p>다음은 공분산단계의 결과물을 이해하기 위한 예제 제어구문 파일의 내용이다. (코드 <a href="method.html#exm:theoph-control-stream">2.1</a>) Theophylline 데이터셋은 12명의 사람에게 320mg의 theophylline을 1회 경구 투여한 자료이며 NONMEM 설치시에 <code>THEO</code> 라는 파일 이름으로 포함되어 있다. 그림은 <a href="nonmem-document.html#Theoph">3.2</a>절을 참고한다.</p>

<div class="example">
<span id="exm:theoph-control-stream" class="example"><strong>Example 2.1  </strong></span>Theophylline의 경구 투여 약동학 자료 모델링을 위한 제어구문 파일
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="method.html#cb2-1"></a><span class="op">$</span>PROB THEOPHYLLINE ORAL</span>
<span id="cb2-2"><a href="method.html#cb2-2"></a><span class="op">$</span>INPUT ID AMT=DROP TIME DV BWT</span>
<span id="cb2-3"><a href="method.html#cb2-3"></a><span class="op">$</span>DATA ..<span class="op">/</span>THEO</span>
<span id="cb2-4"><a href="method.html#cb2-4"></a><span class="op">$</span>PRED</span>
<span id="cb2-5"><a href="method.html#cb2-5"></a>  DOSE =<span class="st"> </span><span class="dv">320</span></span>
<span id="cb2-6"><a href="method.html#cb2-6"></a>  KA   =<span class="st"> </span><span class="kw">THETA</span>(<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">EXP</span>(<span class="kw">ETA</span>(<span class="dv">1</span>))</span>
<span id="cb2-7"><a href="method.html#cb2-7"></a>  V    =<span class="st"> </span><span class="kw">THETA</span>(<span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">EXP</span>(<span class="kw">ETA</span>(<span class="dv">2</span>))</span>
<span id="cb2-8"><a href="method.html#cb2-8"></a>  K    =<span class="st"> </span><span class="kw">THETA</span>(<span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="kw">EXP</span>(<span class="kw">ETA</span>(<span class="dv">3</span>))</span>
<span id="cb2-9"><a href="method.html#cb2-9"></a>  F    =<span class="st"> </span>DOSE<span class="op">/</span>V<span class="op">*</span>KA<span class="op">/</span>(KA <span class="op">-</span><span class="st"> </span>K)<span class="op">*</span>(<span class="kw">EXP</span>(<span class="op">-</span>K<span class="op">*</span>TIME) <span class="op">-</span><span class="st"> </span><span class="kw">EXP</span>(<span class="op">-</span>KA<span class="op">*</span>TIME))</span>
<span id="cb2-10"><a href="method.html#cb2-10"></a>  IPRE =<span class="st"> </span>F</span>
<span id="cb2-11"><a href="method.html#cb2-11"></a>  Y    =<span class="st"> </span>F <span class="op">+</span><span class="st"> </span>F<span class="op">*</span><span class="kw">EPS</span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">EPS</span>(<span class="dv">2</span>)</span>
<span id="cb2-12"><a href="method.html#cb2-12"></a></span>
<span id="cb2-13"><a href="method.html#cb2-13"></a><span class="op">$</span><span class="kw">THETA</span> (<span class="dv">0</span>, <span class="dv">2</span>) (<span class="dv">0</span>, <span class="dv">50</span>) (<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb2-14"><a href="method.html#cb2-14"></a><span class="op">$</span>OMEGA <span class="kw">BLOCK</span>(<span class="dv">3</span>)</span>
<span id="cb2-15"><a href="method.html#cb2-15"></a>  <span class="fl">0.2</span></span>
<span id="cb2-16"><a href="method.html#cb2-16"></a>  <span class="fl">0.1</span>  <span class="fl">0.2</span></span>
<span id="cb2-17"><a href="method.html#cb2-17"></a>  <span class="fl">0.1</span>  <span class="fl">0.1</span>  <span class="fl">0.2</span></span>
<span id="cb2-18"><a href="method.html#cb2-18"></a><span class="op">$</span>SIGMA <span class="fl">0.1</span>  <span class="fl">0.1</span></span>
<span id="cb2-19"><a href="method.html#cb2-19"></a><span class="op">$</span>EST MAX=<span class="dv">9999</span> METHOD=ZERO POSTHOC</span>
<span id="cb2-20"><a href="method.html#cb2-20"></a><span class="op">$</span>COV PRINT=ERS</span>
<span id="cb2-21"><a href="method.html#cb2-21"></a><span class="op">$</span>TAB ID TIME IPRE CWRES\index{conditional weighted residuals <span class="op">/</span><span class="st"> </span>조건부 가중 잔차}</span>
<span id="cb2-22"><a href="method.html#cb2-22"></a>     FILE=sdtab NOPRINT ONEHEADER</span>
<span id="cb2-23"><a href="method.html#cb2-23"></a><span class="op">$</span>TAB ID <span class="kw">ETA</span>(<span class="dv">1</span>) <span class="kw">ETA</span>(<span class="dv">2</span>) <span class="kw">ETA</span>(<span class="dv">3</span>)</span>
<span id="cb2-24"><a href="method.html#cb2-24"></a>     FILE=IndiEta.txt NOAPPEND ONEHEADER FIRSTONLY</span></code></pre></div>
<p>위의 $COV STEP에 의해 생성된 부분은 별첨 1과 같으며, 원래 output은 126열까지까지 있으나, 지면의 제약으로 인해 104열이후는 생략하였다.</p>
<p>$COV에 의해 생성되는 첫 번째 부분(section)은 추정치의 표준오차 부분으로 출력의 직전 section인 FINAL PARAMETER ESTIMATE과 배치 모양이 똑같다. 이후의 출력들은 대개 이를 구하기 위해 필요한 중간계산결과들이다.</p>
<p>$COV 출력의 두 번째 부분은 추정값(estimate)의 분산-공분산행렬(variance-covariance matrix)이다. 이 행렬의 대각원소에다 제곱근을 취한 것이 추정값의 표준오차이다. 이는 뒤에 나오는 R matrix와 S matrix를 사용하여 <span class="math inline">\(R^{- 1}SR^{- 1}\)</span>를 계산한 것이다.</p>
<p>$COV 출력의 세 번째 부분은 직전 부분인 분산-공분산행렬을 상관행렬(correlation matrix)로 변환한 것이다. 다만, 대각원소는 제곱근을 취하여 standard deviation(여기서는 standard error가 됨)을 표시하고 있다.</p>
<p>$COV 출력의 네 번째 부분은 분산-공분산행렬의 역행렬이다. 내부적으로는 이 행렬을 먼저 구한 뒤, 이것의 역행렬을 분산-공분산행렬로 삼는다. 이것의 의미는 Fisher’s Information Matrix (NONMEM에서의 R matrix)와 유사하지만, 계산법은 더 보수적이어서 다르다.</p>
<p>$COV output의 다섯 번째 부분은 상관행렬로부터 구한 고유치(eigenvalue)들을 작은 것부터 순서대로 나열한 것이다. 만약 상관행렬이 positive definite(양정치)라면 이것은 모두 양의 실수로 나와야 한다. 여기에 대한 추가 설명은 <a href="nonmem-document.html#Theoph">14.5</a>를 참고한다.</p>
<p>$COV 출력의 여섯 번째 부분은 R matrix이다. 이는 log likelihood를 parameter들로 이계미분한 것(hessian matrix)으로 Fisher’s Information Matrix(FIM)이라고도 한다. 일반적인 최대가능도추정법(maximum likelihood estimation, MLE)에서는 이것의 역행렬을 분산-공분산 행렬로 삼지만 NONMEM에서는 다음에 나오는 S matrix와 함께 sandwich estimator를 사용한다.</p>
<p>$COV 출력의 마지막 부분은 S matrix이다. 이는 개별 대상자의 log likelihood를 파라미터들로 일계미분값(gradient vector)에 대한 cross product(n by 1 열벡터를 그것의 transpose(1 by n vector)와 곱한 것으로 n by n matrix가 된다)들을 모두 합한 것이다. MLE 이론에 따르면 이상적인 상황에서 S matrix와 R matrix의 기대값은 같다. 하지만, 실제로는 상당히 다를 수 있고, 정규분포 가정도 어긋날 수 있으므로 NONMEM은 <span class="math inline">\(R^{- 1}SR^{- 1}\)</span> 를 분산-공분산행렬로 삼는다.</p>
<p>만약 어떤 원인(예를 들어, R이 singular)에 의해 분산-공분산행렬을 구할 수 없고, 따라서, 표준오차를 구할 수 없다면 $COV에서 MATRIX=R 또는 MATRIX=S 옵션으로 단순화하여 표준오차를 구할 수 있다. 이 경우에는 대개 표준오차가 더 작게 나온다. 어떤 행렬이 singular(비정칙)이어서 역행렬을 구할 수 없다면 NONMEM은 pseudo-inverse matrix를 구하게 되는데, 이는 유일한(unique) 해는 아니므로 해석에 유의해야 한다.</p>
<p>$COV step이 실패하는 경우에는 먼저 파라미터 추정값에 이상이 없는지 살펴보고, 이상이 없어 보이면 붓스트랩이나 profile-likelihood등의 다른 방법을 이용하여 신뢰구간을 구하면 된다. 이 때 신뢰구간이 비대칭일 가능성이 크므로 표준오차는 제시하기 어려워진다. 혹자는 $COV에 의한 표준오차 보다 붓스트랩에 의한 신뢰구간이 (시간은 훨씬 많이 걸리지만) 더 좋다고 한다. 붓스트랩을 할 때는 $COV 절을 삭제하는 것이 시간을 절약하는 방법이다.</p>
</div>
</div>
<h3>참고문헌</h3>
<div id="refs" class="references">
<div id="ref-R-nmw">
<p>Bae, Kyun-Seop. 2018. <em>Nmw: Understanding Nonlinear Mixed Effects Modeling for Population Pharmacokinetics</em>. <a href="https://CRAN.R-project.org/package=nmw">https://CRAN.R-project.org/package=nmw</a>.</p>
</div>
<div id="ref-bae2016r">
<p>Bae, Kyun-Seop, and Dong-Seok Yim. 2016. “R-Based Reproduction of the Estimation Process Hidden Behind Nonmem Part 2: First-Order Conditional Estimation.” <em>Translational and Clinical Pharmacology</em> 24 (4): 161–68.</p>
</div>
<div id="ref-kim2015r">
<p>Kim, Min-Gul, Dong-Seok Yim, and Kyun-Seop Bae. 2015. “R-Based Reproduction of the Estimation Process Hidden Behind Nonmem Part 1: First-Order Approximation Method.” <em>Translational and Clinical Pharmacology</em> 23 (1): 1–7.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nonmem-document.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/asancpt/edison-nmw/edit/master/inst/examples/02.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["nmw.pdf"],
"toc": {
"collapse": "chapter"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
